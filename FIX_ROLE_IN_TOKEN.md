# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –†–æ–ª—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ JWT —Ç–æ–∫–µ–Ω–µ

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞
JWT —Ç–æ–∫–µ–Ω –≤—Å–µ–≥–¥–∞ —Å–æ–¥–µ—Ä–∂–∞–ª `ROLE_USER` –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ä–æ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ –º–µ—Ç–æ–¥ `getRolesForUser()` –±—ã–ª –∂–µ—Å—Ç–∫–æ –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ
–ò–∑–º–µ–Ω–∏–ª–∏ `JwtUtil.java`, —á—Ç–æ–±—ã —Ä–æ–ª—å –±—Ä–∞–ª–∞—Å—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ `UserService`.

---

## üìù –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ

### –§–∞–π–ª: `src/main/java/ru/dugaweld/www/config/JwtUtil.java`

**–ë—ã–ª–æ:**
```java
private String getRolesForUser(String username) {
    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–æ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ username
    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    if ("admin".equals(username)) {
        return "ROLE_ADMIN";
    }
    return "ROLE_USER";
}
```

**–°—Ç–∞–ª–æ:**
```java
@Autowired
private UserService userService;

private String getRolesForUser(String username) {
    // –ü–æ–ª—É—á–∞–µ–º —Ä–æ–ª—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    try {
        User user = userService.findByUsername(username);
        if (user != null && user.getRole() != null) {
            return "ROLE_" + user.getRole().name();
        }
    } catch (Exception e) {
        System.err.println("–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–æ–ª–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è " + username + ": " + e.getMessage());
    }
    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤–æ–∑–≤—Ä–∞—â–∞–µ–º ROLE_USER
    return "ROLE_USER";
}
```

---

## üöÄ –î–µ–ø–ª–æ–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä

### 1. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ**

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh user@141.105.71.70

# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/DugaWeldShop

# –ü–æ–ª—É—á–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
git pull origin main
```

### 2. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ backend**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ backend
# (–Ω–∞–π–¥–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å: ps aux | grep java)
# (—É–±–µ–π—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å: kill <PID>)

# –ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç
./mvnw clean package -DskipTests

# –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∞—à —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞
# ./start-backend.sh
```

### 3. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend**

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ backend
./mvnw spring-boot:run &

# –ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ systemd
sudo systemctl restart dugaweld-backend
```

### 4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—Å—Ç–∏–ª—Å—è**

```bash
curl http://localhost:8080/health
# –î–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å: Backend is healthy!
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è

### 1. **–û—á–∏—Å—Ç–∏—Ç–µ —Ç–æ–∫–µ–Ω—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ**

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –Ω–∞ `http://141.105.71.70:3000`:

```javascript
// –£–¥–∞–ª–∏—Ç–µ –≤—Å–µ —Å—Ç–∞—Ä—ã–µ —Ç–æ–∫–µ–Ω—ã
localStorage.removeItem('dw_admin_token');
localStorage.removeItem('accessToken');
localStorage.removeItem('refreshToken');
localStorage.clear();

console.log('‚úÖ –¢–æ–∫–µ–Ω—ã —É–¥–∞–ª–µ–Ω—ã');
location.reload();
```

### 2. **–í–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ**

- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://141.105.71.70:3000/admin/login`
- –í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω: `ArtemP`
- –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å
- –ù–∞–∂–º–∏—Ç–µ "–í–æ–π—Ç–∏"

### 3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω**

–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
const token = localStorage.getItem('dw_admin_token');
if (token) {
  const payload = JSON.parse(atob(token.split('.')[1]));
  console.log('üîë –¢–æ–∫–µ–Ω:', {
    username: payload.sub,
    role: payload.roles,  // –¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å ROLE_ADMIN!
    expires: new Date(payload.exp * 1000).toLocaleString()
  });
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```javascript
üîë –¢–æ–∫–µ–Ω: {
  username: "ArtemP",
  role: "ROLE_ADMIN",  // ‚Üê –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–æ–ª—å –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö!
  expires: "..."
}
```

### 4. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ**

- –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/admin/products`
- –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
- –î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ –æ—à–∏–±–∫–∏ 403! ‚úÖ

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª–∏ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql -U postgres -d dugaweld_db

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
SELECT id, username, role FROM users;

# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:
# id | username | role
# ---+----------+-------
#  1 | ArtemP   | ADMIN
#  2 | ArtemKa  | USER
```

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:

```bash
# –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
tail -f /var/log/dugaweld/backend.log

# –ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∂—É—Ä–Ω–∞–ª Spring Boot:
tail -f logs/spring-boot-application.log
```

---

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

–¢–µ–ø–µ—Ä—å JWT —Ç–æ–∫–µ–Ω –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ä–æ–ª—å **–∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `ADMIN` –≤ –ë–î ‚Üí —Ç–æ–∫–µ–Ω —Å `ROLE_ADMIN`
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é `USER` –≤ –ë–î ‚Üí —Ç–æ–∫–µ–Ω —Å `ROLE_USER`

–ò –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ

---

## üìå –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–í—ã—Ö–æ–¥ –∏ –≤—Ö–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–∏ –≤ –±–∞–∑–µ (—Ç–æ–∫–µ–Ω –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
2. **–û—á–∏—Å—Ç–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤** –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ –∫—Ä–∏—Ç–∏—á–Ω–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ç–æ–∫–µ–Ω–∞ —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Ä–æ–ª—å—é
3. **Backend –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω** –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞

---

## üêõ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –æ—Å—Ç–∞–ª–∞—Å—å

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º:
   ```bash
   curl http://localhost:8080/actuator/info
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –Ω–∞ –æ—à–∏–±–∫–∏:
   ```bash
   grep "ERROR" logs/spring-boot-application.log
   ```

3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∏–º–µ–µ—Ç —Ä–æ–ª—å ADMIN –≤ –ë–î:
   ```sql
   SELECT username, role FROM users WHERE username = 'ArtemP';
   ```

4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å–æ–¥–µ—Ä–∂–∏—Ç ROLE_ADMIN (–≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞)

